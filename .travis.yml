language: android
branches:
  only:
  - master
android:
  components:
  # - build-tools-26.0.2
  - android-26
  # - android-14
  # - android-15
  # - android-24
  # - android-25
  - build-tools;28.0.3
  - platform-tools
  - tools
  # extras:
  # - android-m2repository
  # - google-m2repository
  # - m2repository-com-android-support-constraint-constraint-layout-solver-1.0.2
  # - m2repository-com-android-support-constraint-constraint-layout-1.0.2
before_install:
# - yes | sdkmanager "platforms;android-27"
#- yes | sdkmanager "ndk-bundle"
# - wget https://dl.google.com/android/repository/android-ndk-r16b-linux-x86_64.zip -nv
# - unzip -q android-ndk-r16b-linux-x86_64.zip
# - mv android-ndk-r16b /usr/local/android-sdk/ndk-bundle
# - yes | sdkmanager "patcher;v4"
# - yes | sdkmanager "cmake;3.6.4111459"
# - yes | sdkmanager "lldb;3.0"
# - openssl aes-256-cbc -K $encrypted_d075d24b0293_key -iv $encrypted_d075d24b0293_iv -in HearingAid-d4e4b3143662.json.enc -out HearingAid-d4e4b3143662.json -d
# - wget https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-127.0.0-linux-x86_64.tar.gz
# - tar xf google-cloud-sdk-127.0.0-linux-x86_64.tar.gz
# - echo "y" | ./google-cloud-sdk/bin/gcloud components update
# - gcloud config set project hearingaid-c625a
# - ./google-cloud-sdk/bin/gcloud auth activate-service-account --key-file HearingAid-d4e4b3143662.json
script:
- chmod +x ./gradlew
- cp ci.local.properties local.properties
- "./gradlew clean lint assembleAndroidTest build"
# - ./google-cloud-sdk/bin/gcloud firebase test android run --type instrumentation --app ./app/build/outputs/apk/debug/app-debug.apk --test ./app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk --device model=Nexus10,version=21,locale=en,orientation=portrait --device model=Nexus5,version=23,locale=en,orientation=portrait --device model=Nexus6P,version=27,locale=en,orientation=portrait
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
after_success:
-
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
